<div *ngIf="loading" class="flex justify-center items-center ">
  <p>Chargement du profil...</p>
</div>

<form *ngIf="!loading" [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="w-full p-4 sm:p-6 lg:p-8  m-4 rounded-3xl">
  <!-- Container principal -->
  <div class="grid grid-cols-1 gap-6">

    <!-- Section Photo -->
    <div class="flex justify-center items-center relative w-full">
      <img [src]="previewUrl || 'assets/images/default-avatar.png'"
           class="w-24 h-24 sm:w-32 sm:h-32 rounded-full border-4 border-blue-100 shadow-lg object-cover"
      >
      <label for="file-input" class="absolute bottom-0 right-1/2 translate-x-8 sm:translate-x-12 mb-1 cursor-pointer">
        <i class="fas fa-pencil-alt text-blue-500 bg-white rounded-full p-1 shadow-md hover:bg-blue-50"></i>
      </label>
      <input id="file-input" type="file" accept="image/*" (change)="onFileChange($event)" class="hidden">
    </div>

    <!-- Section Informations Personnelles -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
      <!-- Prénom -->
      <div class="space-y-2">
        <label class="block text-sm font-semibold text-gray-700">Prénom</label>
        <input type="text" formControlName="firstName"
               class="w-full rounded-full border-gray-300 shadow-sm px-4 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>

      <!-- Nom -->
      <div class="space-y-2">
        <label class="block text-sm font-semibold text-gray-700">Nom</label>
        <input type="text" formControlName="lastName"
               class="w-full rounded-full border-gray-300 shadow-sm px-4 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>

      <!-- Email -->
      <div class="space-y-2">
        <label class="block text-sm font-semibold text-gray-700">Email</label>
        <input type="email" formControlName="email"
               class="w-full rounded-full border-gray-300 shadow-sm px-4 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <div *ngIf="validationErrors['email']" class="text-red-500 text-sm">
          {{ validationErrors['email'][0] }}
        </div>
      </div>

      <!-- Téléphone -->
      <div class="space-y-2">
        <label class="block text-sm font-semibold text-gray-700">Téléphone</label>
        <input type="tel" formControlName="phoneNumber"
               class="w-full rounded-full border-gray-300 shadow-sm px-4 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <div *ngIf="validationErrors['phoneNumber']" class="text-red-500 text-sm">
          {{ validationErrors['phoneNumber'][0] }}
        </div>
      </div>

      <!-- Adresse -->
      <div class="space-y-2">
        <label class="block text-sm font-semibold text-gray-700">Adresse</label>
        <input type="text" formControlName="address"
               class="w-full rounded-full border-gray-300 shadow-sm px-4 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <div *ngIf="validationErrors['address']" class="text-red-500 text-sm">
          {{ validationErrors['address'][0] }}
        </div>
      </div>

      <!-- Ville -->
      <div class="space-y-2">
        <label class="block text-sm font-semibold text-gray-700">Ville</label>
        <input type="text" formControlName="city"
               class="w-full rounded-full border-gray-300 shadow-sm px-4 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <div *ngIf="validationErrors['city']" class="text-red-500 text-sm">
          {{ validationErrors['city'][0] }}
        </div>
      </div>

      <!-- Pays -->
      <div class="space-y-2">
        <label class="block text-sm font-semibold text-gray-700">Pays</label>
        <input type="text" formControlName="country"
               class="w-full rounded-full border-gray-300 shadow-sm px-4 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <div *ngIf="validationErrors['country']" class="text-red-500 text-sm">
          {{ validationErrors['country'][0] }}
        </div>
      </div>

      <!-- Date de naissance -->
      <div class="space-y-2">
        <label class="block text-sm font-semibold text-gray-700">Date de Naissance</label>
        <input type="date" formControlName="dateOfBirth"
               class="w-full rounded-full border-gray-300 shadow-sm px-4 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
        <div *ngIf="validationErrors['dateOfBirth']" class="text-red-500 text-sm">
          {{ validationErrors['dateOfBirth'][0] }}
        </div>
      </div>
    </div>

    <!-- Section Mot de passe -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mt-6">
      <!-- Mot de passe actuel -->
      <div class="space-y-2">
        <label class="block text-sm font-semibold text-gray-700">Mot de Passe Actuel</label>
        <input type="password" formControlName="currentPassword"
               class="w-full rounded-full border-gray-300 shadow-sm px-4 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
        <div *ngIf="validationErrors['currentPassword']" class="text-red-500 text-sm">
          {{ validationErrors['currentPassword'][0] }}
        </div>
      </div>

      <!-- Nouveau mot de passe -->
      <div class="space-y-2">
        <label class="block text-sm font-semibold text-gray-700">Nouveau Mot de Passe</label>
        <input type="password" formControlName="password"
               class="w-full rounded-full border-gray-300 shadow-sm px-4 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500">
        <div *ngIf="validationErrors['password']" class="text-red-500 text-sm">
          {{ validationErrors['password'][0] }}
        </div>
      </div>
    </div>

    <!-- Boutons -->
    <div class="flex flex-col sm:flex-row justify-end gap-4 sm:gap-6 mt-8">
      <button type="button" (click)="cancel()"
              class="w-full sm:w-auto px-6 py-3 border border-gray-300 rounded-full shadow-sm text-sm font-semibold text-gray-700 bg-white hover:bg-gray-100 transition transform hover:scale-105">
        Annuler
      </button>
      <button type="submit" [disabled]="updating"
              class="w-full sm:w-auto px-6 py-3 border border-transparent rounded-full shadow-sm text-sm font-semibold text-white bg-indigo-600 hover:bg-indigo-700 transition transform hover:scale-105">
        {{ updating ? 'Mise à jour...' : 'Sauvegarder' }}
      </button>
    </div>
  </div>
</form>
